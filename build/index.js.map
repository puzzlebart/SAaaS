{"version":3,"sources":["../src/index.js"],"names":["express","morgan","process","platform","require","config","app","use","req","res","next","header","superSecretApiKeys","env","APIKEYS","split","doEnterpriseLevelSecurityCheck","doh","get","json","message","character","headers","apikey","search","query","console","log","JSON","stringify","EnterpriseLevelSecurityCheck","then","passed","Object","keys","send","queryProp","capitalize","queryText","decodeURIComponent","charResults","SAaaSData","filter","char","length","Promise","resolve","reject","includes","s","charAt","toUpperCase","slice","listen","PORT"],"mappings":"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","sourcesContent":["// @ts-ignore\nimport express from 'express'; // framework\nimport morgan from 'morgan'; // request logger\nif (process.platform === \"darwin\") { require(\"dotenv\").config() }\nconst app = express() // express app\napp.use(morgan('tiny')) // morgan\n\n//CORS\napp.use(function(req, res, next) {\n    res.header(\"Access-Control-Allow-Origin\", \"*\");\n    res.header(\"Access-Control-Allow-Headers\", \"Origin, X-Requested-With, Content-Type, Accept, apikey\");\n    next();\n  });\n\n// MICKEY MOUSE ENTERPRISE-GRADE SECURITY AS A SERVICE - MMEGSAaaS\nconst superSecretApiKeys = process.env.APIKEYS.split(\",\")\nconst doEnterpriseLevelSecurityCheck = true;\n\n\n\n// DaaS\nlet doh = app.get('/doh', (req, res) => { res.json({ message: \"D'oh!\" }) }) // D'oh!\n\n// character route\nlet character = app.get([\"/characters\", \"/api/characters\", \"/chars\"], (req, res) => {\n    let headers = req.headers;\n    let apikey = req.headers.apikey;\n    let search = req.query;\n    console.log(`APIKEY: ${JSON.stringify(apikey) || \"none\"}`)\n    EnterpriseLevelSecurityCheck(req, res).then(passed => {\n        if (!passed) return;\n        console.log(`queryprop: ${Object.keys(search)[0]}`)\n        if (!Object.keys(search)[0]) { res.send(`<h1>SAaaS character-endpoint. Retrieve a character using ?name=[charactername] or ?id=[characterId] </h1>`) } else {\n            let queryProp = capitalize(Object.keys(search)[0])\n            let queryText = decodeURIComponent(search[queryProp])\n            let charResults = SAaaSData.filter(char => { if (!char[queryProp]) { return false; } return char[queryProp] == queryText })\n            if (charResults.length) { res.send(JSON.stringify([...charResults])) }\n            else {\n                res.send(`No character with ${queryProp} ${queryText} in the SAaaS-database`)\n            }\n        }\n    });\n})\n\nfunction EnterpriseLevelSecurityCheck(req, res) {\n    return new Promise((resolve, reject) => {\n        if (!doEnterpriseLevelSecurityCheck) { resolve(true); return; }\n        if (!req.headers.apikey) {\n            res.send(`NO API KEY SPECIFIED. ASK PUZZLEBART FOR ONE! We're all about sharing :D`)\n            resolve(false)\n        } else {\n            if (superSecretApiKeys.includes(req.headers.apikey)) { resolve(true) } else {\n                res.send(`WRONG API KEY SPECIFIED. ARE YOU HACKING???!`)\n                resolve(false)\n            }\n        }\n    })\n}\n\n// Stupid sexy jslint\nconst capitalize = (s) => { if (typeof s !== 'string') return ''; return s.charAt(0).toUpperCase() + s.slice(1) }\n\n\napp.get('/', (req, res) => { res.send(`<!DOCTYPE html>\n<html>\n\n<head>\n    <title>Shitty APIs as a Service</title>\n    <link href=\"//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css\"\n        rel=\"stylesheet\">\n    <meta name=\"twitter:card\" content=\"summary\">\n    <meta name=\"twitter:creator\" content=\"@Kimzter\">\n    <meta name=\"og:title\" content=\"Shitty APIs as a Service\">\n    <script src=\"//code.jquery.com/jquery-3.1.1.min.js\" type=\"text/javascript\"></script>\n</head>\n\n<body>\n    <div class=\"container\">\n        <div class=\"hero-unit\">\n            <h1>SAaaS</h1>\n            <h2>Shitty APIs as a Service</h2>\n            <p><em>v1.0.0</em></p>\n        </div>\n    </div>\n    <div class=\"container\">\n        <div class=\"content\" style=\"margin-left:50px;\">\n            <h2 id=\"introduction\">Introduction</h2>\n            <p>SAaaS (Shitty APIs as a Service) enables power users to easily create their own APIS, with only basic html and css-knowledge.</p>\n            <h2 id=\"api\">Create your own API</h2>\n            <h3 id=\"contentnegotiation\">Content Negotiation</h3>\n            <p>SAaaS responds in JSON formatted text</p>\n            <h3 id=\"operations\">Operations</h3>\n            <table class=\"table\" id=\"ops\">\n                <tr>\n                    <th>Path</th>\n                    <th>Description</th>\n                </tr>\n                <tr>\n                    <td>/version</td>\n                    <td>Returns the current SAaaS version number.</td>\n                </tr>\n\n                <tr>\n                    <td>/characters</td>\n                    <td>The main character endpoint</td>\n                </tr>\n                <tr>\n                    <td>/doh</td>\n                    <td>D'oh! As A Service</td>\n                </tr>\n                <tr>\n                    <td>/quotes</td>\n                    <td>quotes from a character, should they have any</td>\n                </tr>\n                <tr>\n                    <td>/picture</td>\n                    <td>Returns the main character photo</td>\n                </tr>\n            </table>\n            <h3 id=\"operations\">Example usage</h3>\n            <p><b>cURL</b></p>\n            <code>curl -L \"http://SAaaS.puzzlebart.no/characters?Name=Homer%20Simpson\" -H apikey:\"YOUR_API_KEY\"</code>\n            <br/>\n            <br/>\n            <p><b>fetch</b></p>\n            <code>await fetch(\"http://SAaaS.puzzlebart.no/characters?Name=Homer%20Simpson\",{headers:{apikey:\"YOUR_API_KEY\"}}).then(d=>d.json().then(r=>r))</code>\n            <p></p>\n            <p><a href=\"https://github.com/puzzlebart/SAaaS\">Fork us on github!</a></p>\n            <p>Created by <a href=\"https://twitter.com/Kimzter\">@Kimzter</a></p>\n        </div>\n    </div>\n</body>\n</html>\n`) }) // default route\n\n\napp.listen(process.env.PORT || '3000', () => console.log(`running on port ${process.env.PORT || '3000'}`)) // starting\n"],"file":"index.js"}