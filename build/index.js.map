{"version":3,"sources":["../src/index.js"],"names":["JSDOM","jsdom","process","platform","require","config","app","set","use","req","res","next","header","superSecretApiKeys","env","APIKEYS","split","doEnterpriseLevelSecurityCheck","randomize","min","max","Math","round","random","get","redirect","json","version","message","status","render","APIS","executeAPI","console","log","url","substring","apiName","trim","shittyApiDefinition","filter","a","name","JSON","stringify","axios","then","r","data","dom","document","window","selectors","allTheThings","querySelectorAll","length","allTheShittyEntries","map","e","entry","textContent","search","EnterpriseLevelSecurityCheck","passed","q","query","error","decodeURIComponent","toLowerCase","matches","api","indexOf","Promise","resolve","reject","headers","apikey","includes","capitalize","s","charAt","toUpperCase","slice","matchesAnAPI","listen","PORT"],"mappings":"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","sourcesContent":["// @ts-ignore\nimport APIS from \"./apis.json\";\nimport \"@babel/polyfill\";\nimport express from 'express'; // framework, yo\n// import cheerio from 'cheerio'; // IM TRYING JSOM MOM\nimport jsdom from \"jsdom\";\nconst { JSDOM } = jsdom;\n\nimport axios from \"axios\";\nif (process.platform === \"darwin\") { require(\"dotenv\").config() } // enterprise-grade MacOS-detection\nconst app = express() // express app instance\napp.set('view engine', 'ejs')\n\n\n\n\n//CORS\napp.use(function (req, res, next) {\n    res.header(\"Access-Control-Allow-Origin\", \"*\");\n    // Remember to have apikey here, else our enterprise-grade authorization-system will fail\n    res.header(\"Access-Control-Allow-Headers\", \"Origin, X-Requested-With, Content-Type, Content-Length, Cache-Control, Accept, apikey\");\n    next();\n});\n\n\n// MICKEY MOUSE ENTERPRISE-GRADE SECURITY AS A SERVICE\nconst superSecretApiKeys = process.env.APIKEYS.split(\",\")\nconst doEnterpriseLevelSecurityCheck = true;\n// ENTERPRISE GRADE RANDOMIZATION ENGINE\nconst randomize = (min, max) => Math.round((Math.random() * (max - min) + min))\n\napp.get('/tihi', (req, res) => { res.redirect(\"https://www.youtube.com/watch?v=-Lez_WdX7Oc\") })// TIHIaaS -  Thanks, I hate it as a Service\napp.get(\"/version\", (req, res) => { res.json({ version: \"1.0.0\" }) })// version\napp.get('/doh', (req, res) => { res.json({ message: \"D'oh!\" }) }) // DaaS - DÂ´oh! as a Service\n\n\n// GET a named API by title or whatever\napp.get('/get', (req, res) => { res.status(501); res.render(\"error\") }) // D'oh!\n\n// list all created apis\napp.get(\"/list\", (req, res) => res.json(APIS))\n\n\n//Do lol stuff here with cheerio\nasync function executeAPI(req, res) {\n    console.log(`EXECUTEAPI ${req.url.substring(1)}`)\n    let apiName = req.url.substring(1).trim();\n    let shittyApiDefinition = APIS.filter(a => a.name === apiName)[0] // we already know it exists 'cause we checked right\n    console.log(`THIS IS THE SHITTY API DEFINITION T.I.H.I.`)\n    console.log(JSON.stringify(shittyApiDefinition))\n    const url = shittyApiDefinition.url;\n    axios.get(url).then(r => {\n        const data = r.data\n        const dom = new JSDOM(data)\n        let document = dom.window.document; // ah it's so familiar\n\n        // THIS IS WHERE ALL THE SHITTY MAGIC HAPPENS\n\n        console.log(`SELECTORS: ${shittyApiDefinition.selectors}`)\n        let allTheThings = document.querySelectorAll(shittyApiDefinition.selectors);\n        if (allTheThings.length) {\n            let allTheShittyEntries = [...allTheThings].map(e => { return { entry: e.textContent.trim() } })\n            // console.log(allTheShittyEntries)\n            res.json(allTheShittyEntries)\n        } else {\n            res.json({ message: \"no entries in your shitty api\" })\n        }\n    })\n}\n\n\n// SEARCH FUNCTION YEAOIAUSODIUASDOIS\nlet search = app.get([\"/search\", \"/find\"], (req, res) => {\n    EnterpriseLevelSecurityCheck(req, res).then(passed => {\n        let q = req.query.q;\n        if (!q) res.json({ error: \"no query specified. use ?q=[querystring]\" })\n        if (q.length < 1) { res.json({ message: \"type at least two characters to search\" }) } else {\n            q = decodeURIComponent(q.toLowerCase());\n            let matches = APIS.filter(api => {\n                let name = api.name ? api.name.toLowerCase() : \"\";\n                return name.indexOf(q) > -1\n            })\n            res.json(matches.length ? matches : { message: \"no shitty API matches :'-(\" })\n        }\n    })\n})\n\n// ENTERPRISE LEVEL SECURITY ENGINE AUTOMATRON - DO NOT TOUCH IT'S PERFECT THANKS\nfunction EnterpriseLevelSecurityCheck(req, res) {\n    return new Promise((resolve, reject) => {\n        if (!doEnterpriseLevelSecurityCheck || req.get('host').indexOf(\"localhost\") > -1) { resolve(true); return; }\n        if (!req.headers.apikey && !req.query.apikey) {\n            res.json({ error: `NO API KEY SPECIFIED. ASK PUZZLEBART FOR ONE! We're all about sharing :D` })\n            resolve(false)\n        } else {\n            if (superSecretApiKeys.includes(req.headers.apikey) || superSecretApiKeys.includes(req.query.apikey)) { resolve(true) } else {\n                res.json({ error: `WRONG API KEY SPECIFIED - ARE YOU HACKING???!` })\n                resolve(false)\n            }\n        }\n    })\n}\n// END SECURITIFICATION\n\n\n// Stupid sexy jslint\nconst capitalize = (s) => { if (typeof s !== 'string') return ''; return s.charAt(0).toUpperCase() + s.slice(1) }\n\n\n// FRONT PAGE\napp.get('/', (req, res) => { res.render(\"index\") });\n\nconst matchesAnAPI = (apiName) => {\n    console.log(`checking whether the \"${apiName}\" api exists`)\n    let matches = APIS.filter(a => a.name === apiName).length == 1\n    console.log(`api-match: ${matches}`)\n    return matches\n}\n\n// error route\napp.get('(/*)?', (req, res) => matchesAnAPI(req.url.substring(1)) ? executeAPI(req, res) : res.render(`error`)) // D'oh!\n\napp.listen(process.env.PORT || '3000', () => console.log(`running on port ${process.env.PORT || '3000'}`))"],"file":"index.js"}